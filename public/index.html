<!doctype html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Inscription MGC</title>
  <link rel="icon" type="image/svg+xml" href="icons/mgc.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- test si telegram se lance apr√®s app.js
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const tgTest = window.Telegram.WebApp;
        tgTest.ready();

        alert(
          "V√©rification Telegram : " +
            (tgTest.initData ? "Donn√©es re√ßues !" : "VIDE"),
        );
      });
    </script> -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
      eruda.init();
    </script> -->
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Plus Jakarta Sans"', "sans-serif"],
          },
          colors: {
            lemon: {
              300: "#fde047",
              400: "#facc15",
              500: "#eab308",
              900: "#713f12",
            },
          },
          animation: {
            shimmer: "shimmer 2s linear infinite",
          },
        },
      },
    };
  </script>
  <style>
    body {
      -webkit-tap-highlight-color: transparent;
      -webkit-overflow-scrolling: touch;
      display: none;
    }

    .input-fast {
      background: #f9fafb;
      transition:
        border-color 0.2s ease,
        box-shadow 0.2s ease;
    }

    .input-fast:focus {
      background: #ffffff;
      border-color: #facc15;
      box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.15);
      outline: none;
    }

    ::-webkit-scrollbar {
      width: 0px;
      background: transparent;
    }
  </style>
</head>

<body style="display: none" class="antialiased pb-32 relative overflow-x-hidden min-h-screen text-gray-900 bg-gray-50">
  <div class="fixed inset-0 z-0 pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-br from-gray-100 via-yellow-50 to-gray-100"></div>
    <div class="absolute inset-0 opacity-[0.06]" style="
          background-image: url(&quot;data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='1' fill-rule='evenodd'/%3E%3C/svg%3E&quot;);
        "></div>
  </div>

  <div class="relative z-10 px-4 pt-6">
    <header class="text-center mb-8">
      <h1 class="text-3xl font-black tracking-tighter text-gray-900">
        Inscription MGC
      </h1>
      <p class="text-sm font-medium text-gray-500 mt-1">
        Formulaire d'enregistrement
      </p>
    </header>
    <div class="text-center mb-4">
      <span
        class="inline-flex items-center gap-1.5 py-1.5 px-3 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200">
        <img src="icons/user.png" alt="Icone Utilisateur" class="w-4 h-4 object-contain" />

        Connect√© :
        <span id="telegram-user-display" class="font-bold">Chargement...</span>
      </span>
    </div>

    <div class="max-w-lg mx-auto space-y-6">
      <div class="relative group">
        <div
          class="absolute -inset-0.5 bg-gradient-to-r from-yellow-300 to-yellow-500 rounded-2xl opacity-40 group-hover:opacity-100 transition duration-1000 group-hover:duration-200 blur">
        </div>
        <div class="relative bg-white rounded-2xl p-6 shadow-xl border border-yellow-400/20">
          <div class="flex items-center mb-4 text-xs font-bold uppercase tracking-wider text-yellow-700">
            <img src="icons/fruit.svg" alt="Icone Utilisateur" class="w-6 h-6 mr-2 object-contain" />
            Fruit
          </div>

          <div class="space-y-5">
            <input type="hidden" id="studentId" value="" />
            <div id="grp-nom">
              <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">NOM COMPLET *</label>
              <input type="text" id="nomComplet" placeholder="Ex: RAKOTO PAUL"
                class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-semibold placeholder-gray-400 text-gray-900 uppercase"
                oninput="
                    clearError();
                    this.value = this.value.toUpperCase();
                  " />
            </div>

            <div>
              <label class="block text-xs font-bold text-gray-500 mb-2 ml-1">GENRE</label>

              <input type="hidden" id="sexeInput" value="" />

              <div class="flex items-center space-x-6 pl-2">
                <label class="flex items-center cursor-pointer group">
                  <input type="radio" name="sexe_radio" value="H" onclick="setSexe('M')"
                    class="w-5 h-5 accent-yellow-500 cursor-pointer transition-transform group-active:scale-90" />
                  <span
                    class="ml-2 text-gray-700 font-bold text-sm group-hover:text-yellow-700 transition-colors">Lahy</span>
                </label>

                <label class="flex items-center cursor-pointer group">
                  <input type="radio" name="sexe_radio" value="F" onclick="setSexe('F')"
                    class="w-5 h-5 accent-yellow-500 cursor-pointer transition-transform group-active:scale-90" />
                  <span
                    class="ml-2 text-gray-700 font-bold text-sm group-hover:text-yellow-700 transition-colors">Vavy</span>
                </label>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">T√âL√âPHONE *</label>
                <input type="tel" id="telephone" placeholder="034..."
                  class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900" />
              </div>
              <div>
                <label class="flex justify-between items-center text-xs font-bold text-gray-500 mb-1 ml-1">
                  <span>NAISSANCE *</span>
                  <span id="ageCalc" class="text-sm text-yellow-600 font-normal"></span>
                </label>

                <input type="date" id="dateNaissance"
                  class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900" />
              </div>
            </div>

            <div>
              <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">FACEBOOK *</label>
              <input type="text" id="facebook" placeholder="Nom ou lien Facebook"
                class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900" />
            </div>
            <div>
              <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">
                CLASSE
              </label>
              <div class="relative">
                <select id="classeSelect"
                  class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900 appearance-none bg-white transition-colors cursor-pointer">
                  <option value="" disabled selected>
                    S√©lectonner une classe
                  </option>
                </select>

                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                  <svg class="h-4 w-4 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                  </svg>
                </div>
              </div>
            </div>
            <button type="button" onclick="checkDuplicates()" id="btn-check"
              class="w-full flex justify-center items-center gap-2 py-3.5 rounded-xl font-bold text-sm transition-all active:scale-95 bg-yellow-50 text-yellow-800 border border-yellow-200 hover:bg-yellow-100 hover:border-yellow-300">
              <img src="icons/duplicate.svg" alt="Icone Duplicate" class="w-5 h-5 object-contain" />

              <span id="check-text">Check doublons</span>
            </button>
          </div>
        </div>
      </div>

      <div class="relative group">
        <div
          class="absolute -inset-0.5 bg-gradient-to-r from-yellow-400 to-yellow-200 rounded-2xl opacity-40 group-hover:opacity-100 transition duration-1000 group-hover:duration-200 blur">
        </div>
        <div class="relative bg-white rounded-2xl p-6 shadow-xl border border-yellow-400/20">
          <div class="flex items-center mb-4 text-xs font-bold uppercase tracking-wider text-yellow-600">
            <img src="icons/tree.svg" alt="Icone tree" class="w-6 h-6 mr-2 object-contain" />
            Tree
          </div>
          <div class="space-y-4">
            <div>
              <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">ID SMADA</label>
              <input type="text" id="idApp" onblur="getDataTree()"
                class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-mono text-sm text-gray-900" />
            </div>
            <div>
              <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">NOM TREE</label>
              <input type="text" id="nomTree"
                class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900" />
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">TEL TREE</label>
                <input type="tel" id="telTree"
                  class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900" />
              </div>
              <div>
                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">
                  LIAISON
                </label>
                <select id="liaison"
                  class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900 bg-white">
                  <option value="" disabled selected>
                    S√©lectionnez une liaison...
                  </option>
                  <option value="Parent">Parent (RAD)</option>
                  <option value="Child">Child (Zanaka)</option>
                  <option value="Spouse">Spouse (Vady)</option>
                  <option value="Sibling">Sibling (Iray tampo)</option>
                  <option value="Family">Family (Fianakaviana)</option>
                  <option value="Friend">Friend (Namana)</option>
                  <option value="Acquaintance">
                    Acquaintance (Olom-pantatra)
                  </option>
                  <option value="NB">NB</option>
                </select>
              </div>
            </div>
            <div>
              <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">DEPARTEMENT/CLASSE</label>
              <input type="text" id="departement"
                class="input-fast w-full border border-gray-200 rounded-xl px-4 py-3.5 font-medium text-gray-900" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="fixed bottom-0 left-0 right-0 p-4 pt-12 bg-gradient-to-t from-gray-50 via-gray-50 to-transparent z-40">
    <button id="main-btn" onclick="submitForm()"
      class="relative w-full bg-gradient-to-r from-lemon-400 to-lemon-500 text-gray-900 font-bold text-lg py-4 rounded-2xl shadow-lg shadow-xl shadow-black/5 active:scale-[0.98] transition-transform overflow-hidden group">
      <div
        class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-transparent via-white/40 to-transparent -translate-x-full animate-shimmer group-hover:animate-none">
      </div>
      <div class="relative flex justify-center items-center">
        <span id="spinner"
          class="animate-spin h-5 w-5 border-2 border-gray-900 border-t-transparent rounded-full mr-3 hidden"></span>

        <span id="btn-text" class="flex items-center gap-2">
          <img src="icons/save.svg" alt="Icone save" class="w-8 h-8 object-contain" />
          <span>Enregistrer le dossier</span>
        </span>
      </div>
    </button>
  </div>

  <div id="duplicate-modal"
    class="fixed inset-0 z-[60] flex items-center justify-center bg-gray-900/60 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
    <div
      class="relative bg-white/95 w-11/12 max-w-sm rounded-3xl p-6 shadow-2xl border border-yellow-400/30 transform scale-95 transition-transform duration-300"
      id="modal-content">
      <div class="absolute top-0 left-0 w-full h-20 bg-gradient-to-b from-yellow-50 to-transparent rounded-t-3xl -z-10">
      </div>

      <div class="text-center mb-6">
        <div
          class="mx-auto flex items-center justify-center h-14 w-14 rounded-full bg-yellow-100 text-3xl shadow-sm border border-yellow-200 mb-3">
          ‚ö†Ô∏è
        </div>
        <h3 class="text-xl font-black text-gray-900 tracking-tight">
          Attention !
        </h3>
        <p class="text-sm font-medium text-gray-500 mt-1">
          Ce nom ressemble √† des dossiers existants.
        </p>
      </div>

      <div id="duplicate-list" class="space-y-3 mb-6 max-h-60 overflow-y-auto pr-1"></div>

      <div class="space-y-3">
        <button onclick="closeModal()"
          class="w-full py-3.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-bold text-sm transition-colors">
          Non, c'est une nouvelle personne
        </button>
      </div>
    </div>
  </div>

  <div id="success-modal"
    class="fixed inset-0 z-[70] flex items-center justify-center bg-gray-900/80 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
    <div
      class="relative bg-white w-11/12 max-w-sm rounded-3xl p-6 shadow-2xl border-2 border-green-400 transform scale-95 transition-transform duration-300 text-center">
      <div
        class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-100 text-5xl shadow-sm border-4 border-white -mt-16 mb-4 relative z-10">
        üéâ
      </div>

      <h3 class="text-2xl font-black text-gray-900 tracking-tight mb-6">
        Inscription R√©ussie !
      </h3>

      <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-6 relative overflow-hidden group">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-300 to-orange-400"></div>

        <p class="text-xs font-bold text-yellow-700 uppercase tracking-widest mb-1">
          ID APP :
        </p>
        <div id="generated-id" class="text-3xl font-mono font-black text-gray-900 tracking-wider"></div>

        <hr class="border-yellow-200 my-3 mx-8" />

        <p class="text-xs font-bold text-yellow-700 uppercase tracking-widest mb-1">
          MOT DE PASSE :
        </p>
        <div class="text-2xl font-mono font-bold text-gray-800 tracking-widest">
          123456789
        </div>
      </div>

      <button onclick="closeSuccessModal()"
        class="w-full py-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-green-200 transition-all active:scale-95">
        G√©nial, merci !
      </button>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>

</html>